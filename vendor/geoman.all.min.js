L.BingLayer=L.TileLayer.extend({options:{subdomains:[0,1,2,3],type:"Aerial",attribution:"Bing",culture:""},initialize:function(e,t){L.Util.setOptions(this,t);this._key="AnRvpIKUSa29ARhk7djgoB5NjakSkchyrtlEqozjs3cAzwJ5s2SnJ7VAKhW2RVAC";this._url=null;this.meta={};this.loadMetadata()},tile2quad:function(e,t,n){var r="";for(var i=n;i>0;i--){var s=0;var o=1<<i-1;if((e&o)!=0)s+=1;if((t&o)!=0)s+=2;r=r+s}return r},getTileUrl:function(e,t){var t=this._getZoomForUrl();var n=this.options.subdomains,r=this.options.subdomains[Math.abs((e.x+e.y)%n.length)];return this._url.replace("{subdomain}",r).replace("{quadkey}",this.tile2quad(e.x,e.y,t)).replace("{culture}",this.options.culture)},loadMetadata:function(){var e=this;var t="_bing_metadata_"+L.Util.stamp(this);window[t]=function(n){console.log(n);e.meta=n;window[t]=undefined;var r=document.getElementById(t);r.parentNode.removeChild(r);if(n.errorDetails){alert("Got metadata"+n.errorDetails);return}e.initMetadata()};var n="http://dev.virtualearth.net/REST/v1/Imagery/Metadata/"+this.options.type+"?include=ImageryProviders&jsonp="+t+"&key="+this._key;var r=document.createElement("script");r.type="text/javascript";r.src=n;r.id=t;document.getElementsByTagName("head")[0].appendChild(r)},initMetadata:function(){var e=this.meta.resourceSets[0].resources[0];this.options.subdomains=e.imageUrlSubdomains;this._url=e.imageUrl;this._providers=[];for(var t=0;t<e.imageryProviders.length;t++){var n=e.imageryProviders[t];for(var r=0;r<n.coverageAreas.length;r++){var i=n.coverageAreas[r];var s={zoomMin:i.zoomMin,zoomMax:i.zoomMax,active:false};var o=new L.LatLngBounds(new L.LatLng(i.bbox[0]+.01,i.bbox[1]+.01),new L.LatLng(i.bbox[2]-.01,i.bbox[3]-.01));s.bounds=o;s.attrib=n.attribution;this._providers.push(s)}}this._update()},_update:function(){if(this._url==null||!this._map)return;this._update_attribution();L.TileLayer.prototype._update.apply(this,[])},_update_attribution:function(){var e=this._map.getBounds();var t=this._map.getZoom();for(var n=0;n<this._providers.length;n++){var r=this._providers[n];if(t<=r.zoomMax&&t>=r.zoomMin&&e.intersects(r.bounds)){if(!r.active&&this._map.attributionControl)this._map.attributionControl.addAttribution(r.attrib);r.active=true}else{if(r.active&&this._map.attributionControl)this._map.attributionControl.removeAttribution(r.attrib);r.active=false}}},onRemove:function(e){for(var t=0;t<this._providers.length;t++){var n=this._providers[t];if(n.active&&this._map.attributionControl){this._map.attributionControl.removeAttribution(n.attrib);n.active=false}}L.TileLayer.prototype.onRemove.apply(this,[e])}});L.Google=L.Class.extend({includes:L.Mixin.Events,options:{minZoom:0,maxZoom:18,tileSize:256,subdomains:"abc",errorTileUrl:"",attribution:"",opacity:1,continuousWorld:false,noWrap:false},initialize:function(e,t){L.Util.setOptions(this,t);this._ready=google.maps.Map!=undefined;if(!this._ready)L.Google.asyncWait.push(this);this._type=e||"SATELLITE"},onAdd:function(e,t){this._map=e;this._insertAtTheBottom=t;this._initContainer();this._initMapObject();e.on("viewreset",this._resetCallback,this);this._limitedUpdate=L.Util.limitExecByInterval(this._update,150,this);e.on("move",this._update,this);e._controlCorners["bottomright"].style.marginBottom="1em";this._reset();this._update()},onRemove:function(e){this._map._container.removeChild(this._container);this._map.off("viewreset",this._resetCallback,this);this._map.off("move",this._update,this);e._controlCorners["bottomright"].style.marginBottom="0em"},getAttribution:function(){return this.options.attribution},setOpacity:function(e){this.options.opacity=e;if(e<1){L.DomUtil.setOpacity(this._container,e)}},setElementSize:function(e,t){e.style.width=t.x+"px";e.style.height=t.y+"px"},_initContainer:function(){var e=this._map._container,t=e.firstChild;if(!this._container){this._container=L.DomUtil.create("div","leaflet-google-layer leaflet-top leaflet-left");this._container.id="_GMapContainer_"+L.Util.stamp(this);this._container.style.zIndex="auto"}if(true){e.insertBefore(this._container,t);this.setOpacity(this.options.opacity);this.setElementSize(this._container,this._map.getSize())}},_initMapObject:function(){if(!this._ready)return;this._google_center=new google.maps.LatLng(0,0);var e=new google.maps.Map(this._container,{center:this._google_center,zoom:0,tilt:0,mapTypeId:google.maps.MapTypeId[this._type],disableDefaultUI:true,keyboardShortcuts:true,draggable:false,disableDoubleClickZoom:true,scrollwheel:false,streetViewControl:false});var t=this;this._reposition=google.maps.event.addListenerOnce(e,"center_changed",function(){t.onReposition()});e.backgroundColor="#ff0000";this._google=e},_resetCallback:function(e){this._reset(e.hard)},_reset:function(e){this._initContainer()},_update:function(){if(!this._google)return;this._resize();var e=this._map.getBounds();var t=e.getNorthEast();var n=e.getSouthWest();var r=new google.maps.LatLngBounds(new google.maps.LatLng(n.lat,n.lng),new google.maps.LatLng(t.lat,t.lng));var i=this._map.getCenter();var s=new google.maps.LatLng(i.lat,i.lng);this._google.setCenter(s);this._google.setZoom(this._map.getZoom())},_resize:function(){var e=this._map.getSize();if(this._container.style.width==e.x&&this._container.style.height==e.y)return;this.setElementSize(this._container,e);this.onReposition()},onReposition:function(){if(!this._google)return;google.maps.event.trigger(this._google,"resize")}});L.Google.asyncWait=[];L.Google.asyncInitialize=function(){var e;for(e=0;e<L.Google.asyncWait.length;e++){var t=L.Google.asyncWait[e];t._ready=true;if(t._container){t._initMapObject();t._update()}}L.Google.asyncWait=[]};L.WikimapiaJSON=L.FeatureGroup.extend({initialize:function(e,t){var n=this,r,i;L.setOptions(n,t);n._layers={};if(e&&e.folder.length>0){for(r=0;r<e.folder.length;r++){var s=e.folder[r].polygon,o=[];for(i=0;i<s.length;i++){o.push([s[i].y,s[i].x])}var u=new L.Polygon(o);u.feature=e.folder[r];n.resetStyle(u);if(t.onEachFeature){t.onEachFeature(u.feature,u)}n.addLayer(u)}}},resetStyle:function(e){var t=this,n=this.options.style;if(n){L.Util.extend(e.options,e.defaultOptions);t._setLayerStyle(e,n)}},setStyle:function(e){var t=this;t.eachLayer(function(n){t._setLayerStyle(n,e)},t)},_setLayerStyle:function(e,t){if(typeof t==="function"){t=t(e.feature)}if(e.setStyle){e.setStyle(t)}}});L.WikimapiaInteractive=L.Class.extend({includes:L.Mixin.Events,timer:null,mouseMoveTimer:null,counter:0,options:{url:"http://api.wikimapia.org/",opacity:1,attribution:'<a href="http://wikimapia.org" target="_blank">Wikimapia.org</a>'},initialize:function(e){var t=this;L.setOptions(t,e);t._hash={};t._mouseIsDown=false;t._popupIsOpen=false;t._layer=new L.LayerGroup([])},setOptions:function(e){var t=this;L.setOptions(t,e);t._update()},onAdd:function(e){var t=this;t._map=e;t._layer.addTo(t._map);e.on("viewreset",t._update,t);e.on("moveend",t._update,t);e.on("zoomend",t._update,t);e.on("mousemove",t._mousemove,t);e.on("mouseout",t._mouseout,t);e.on("mousedown",t._mousedown,t);e.on("mouseup",t._mouseup,t);e.on("popupopen",t._popup_open,t);e.on("popupclose",t._popup_close,t);t._update()},onRemove:function(e){var t=this;e.off("viewreset",t._update,t);e.off("moveend",t._update,t);e.off("zoomend",t._update,t);e.off("mousemove",t._mousemove,t);e.off("mouseout",t._mouseout,t);e.off("mousedown",t._mousedown,t);e.off("mouseup",t._mouseup,t);e.off("popupopen",t._popup_open,t);e.off("popupclose",t._popup_close,t)},addTo:function(e){e.addLayer(this);return this},getAttribution:function(){return this.options.attribution},_wikiPointsToPolygon:function(e){coords=[];for(j=0;j<e.length;j++){coords.push([e[j].y,e[j].x])}return new L.Polygon(coords)},_hideFeature:function(){var e=this;if(e._feature&&!e._popupIsOpen){e._feature.polygon.off("mouseout");e._map.removeLayer(e._feature.polygon);e._feature=null}},_showFeature:function(e){var t=this;if(!(t._feature&&t._feature.id==e.id||t._popupIsOpen)){t._hideFeature();var n=jQuery.extend(true,{},e.polygon);t._feature=jQuery.extend(true,{},e);t._feature.polygon=n;if(t.options.onActiveFeature){t.options.onActiveFeature(t._feature,t._feature.polygon)}if(t.options.onActiveFeatureStyle){t._feature.polygon.setStyle(t.options.onActiveFeatureStyle(t._feature))}t._feature.polygon.on("mouseout",function(e){var n=t._map.getSize();if(e.containerPoint.x<0||e.containerPoint.y<0||e.containerPoint.x>n.x-10||e.containerPoint.y>n.y-10){t._hideFeature()}}).addTo(t._map)}},_mousemove:function(e){var t=this;if(!t._mouseIsDown){var n=e.latlng,r=t._filter(t._hash,function(e){return e.bounds.contains(n)&&t._pointInPolygon(n,e.polygon)});if(r.length>0){var i=r.length==1?r[0]:t._chooseBestFeature(r);t._showFeature(i)}else{t._hideFeature()}}},_mousedown:function(){this._mouseIsDown=true},_mouseup:function(){this._mouseIsDown=false},_mouseout:function(){this._hideFeature()},_popup_open:function(){this._popupIsOpen=true},_popup_close:function(){this._popupIsOpen=false},_chooseBestFeature:function(e){var t=this,n=t._boundsArea(t._map.getBounds())/12,r=0,i=t._boundsArea(e[0].bounds)/n;if(i<1){i=1/i}for(var s=1;s<e.length;s++){var o=t._boundsArea(e[s].bounds),u=o/n;if(u<1){u=1/u}if(u<i){r=s;i=u}}return e[r]},_boundsArea:function(e){var t=e.getSouthWest(),n=e.getNorthEast();return(n.lat-t.lat)*(n.lat-t.lat)+(n.lng-t.lng)*(n.lng-t.lng)},_filter:function(e,t){var n=[];$.each(e,function(e,r){if(t(r)){n.push(r)}});return n},_pointInPolygon:function(e,t){var n=e.lng,r=e.lat,i=t.getLatLngs(),s=false;for(var o=0,u=i.length-1;o<i.length;u=o++){var a=i[o].lng,f=i[o].lat,l=i[u].lng,c=i[u].lat,h=f>r!=c>r&&n<(l-a)*(r-f)/(c-f)+a;if(h)s=!s}return s},_draw:function(){var e=this,t=[],n=e._map.getBounds(),r=0,i=e._filter(e._hash,function(e){r++;return n.contains(e.polygon.getBounds())});e._layer.clearLayers();console.log("_draw: "+i.length+" from "+r);for(var s=0;s<i.length;s++){var o=i[s].polygon;if(e.options.style){o.setStyle(e.options.style(e._feature))}e._layer.addLayer(o)}},_update:function(){var e=this;e.counter++;$.ajax({url:e.options.url,dataType:"jsonp",jsonp:"jsoncallback",data:{"function":"box",bbox:e._map.getBounds().toBBoxString(),key:e.options.key,format:"jsonp",count:"100",pack:"gzip",language:(window.navigator.userLanguage||window.navigator.language).split("-")[0]},jsonpCallback:"wikimapiacallback"+e.counter,success:function(t){e.counter--;if(t){for(var n=0;n<t.folder.length;n++){var r=t.folder[n];e._hash[r.id]={id:r.id,name:r.name,url:r.url,bounds:L.latLngBounds([r.location.south,r.location.west],[r.location.north,r.location.east]),polygon:e._wikiPointsToPolygon(r.polygon)}}}}})}});L.WikimapiaFeatures=L.Class.extend({includes:L.Mixin.Events,timer:null,mouseMoveTimer:null,counter:0,options:{url:"http://api.wikimapia.org/",opacity:1,attribution:'<a href="http://wikimapia.org" target="_blank">Wikimapia.org</a>'},initialize:function(e){var t=this;L.setOptions(t,e);t._hash={};t._layer=new L.FeatureGroup([])},setOptions:function(e){var t=this;L.setOptions(t,e);t._update()},onAdd:function(e){var t=this;t._map=e;t._layer.addTo(t._map);e.on("viewreset",t._update,t);e.on("moveend",t._update,t);e.on("zoomend",t._update,t);t._update()},onRemove:function(e){var t=this;e.off("viewreset",t._update,t);e.off("moveend",t._update,t);e.off("zoomend",t._update,t)},addTo:function(e){e.addLayer(this);return this},getAttribution:function(){return this.options.attribution},_wikiPointsToPolygon:function(e){coords=[];for(j=0;j<e.length;j++){coords.push([e[j].y,e[j].x])}return new L.Polygon(coords)},_filter:function(e,t){var n=[];$.each(e,function(e,r){if(t(r)){n.push(r)}});return n},_draw:function(){var e=this,t=[],n=e._map.getBounds(),r=0,i=e._filter(e._hash,function(e){r++;return n.intersects(e.polygon.getBounds())||n.contains(e.polygon.getBounds())});e._layer.clearLayers();console.log("_draw: "+i.length+" from "+r);for(var s=0;s<i.length;s++){e._layer.addLayer(i[s].polygon)}},_update:function(){console.log("update");var e=this;e._draw();console.log("ajaxin");e.counter++;$.ajax({url:e.options.url,dataType:"jsonp",jsonp:"jsoncallback",data:{"function":"box",bbox:e._map.getBounds().toBBoxString(),key:e.options.key,format:"jsonp",count:"100",pack:"gzip"},jsonpCallback:"wikimapiacallback"+e.counter,success:function(t){console.log("success");e.counter--;if(t){for(var n=0;n<t.folder.length;n++){var r=t.folder[n];e._hash[r.id]={id:r.id,name:r.name,url:r.url,bounds:L.latLngBounds([r.location.south,r.location.west],[r.location.north,r.location.east]),polygon:e._wikiPointsToPolygon(r.polygon)}}e._draw()}}});console.log("ajaxout")}});L.Yandex=L.Class.extend({includes:L.Mixin.Events,options:{minZoom:0,maxZoom:18,attribution:"",opacity:1,traffic:false},initialize:function(e,t){L.Util.setOptions(this,t);this._type="yandex#"+(e||"map")},onAdd:function(e,t){this._map=e;this._insertAtTheBottom=t;this._initContainer();this._initMapObject();e.on("viewreset",this._resetCallback,this);this._limitedUpdate=L.Util.limitExecByInterval(this._update,150,this);e.on("move",this._update,this);e._controlCorners["bottomright"].style.marginBottom="3em";this._reset();this._update(true)},onRemove:function(e){this._map._container.removeChild(this._container);this._map.off("viewreset",this._resetCallback,this);this._map.off("move",this._update,this);e._controlCorners["bottomright"].style.marginBottom="0em"},getAttribution:function(){return this.options.attribution},setOpacity:function(e){this.options.opacity=e;if(e<1){L.DomUtil.setOpacity(this._container,e)}},setElementSize:function(e,t){e.style.width=t.x+"px";e.style.height=t.y+"px"},_initContainer:function(){var e=this._map._container,t=e.firstChild;if(!this._container){this._container=L.DomUtil.create("div","leaflet-yandex-layer leaflet-top leaflet-left");this._container.id="_YMapContainer_"+L.Util.stamp(this);this._container.style.zIndex="auto"}if(this.options.overlay){t=this._map._container.getElementsByClassName("leaflet-map-pane")[0];t=t.nextSibling;if(L.Browser.opera)this._container.className+=" leaflet-objects-pane"}e.insertBefore(this._container,t);this.setOpacity(this.options.opacity);this.setElementSize(this._container,this._map.getSize())},_initMapObject:function(){if(this._yandex)return;if(ymaps.Map===undefined){console.debug("L.Yandex: Waiting on ymaps.load('package.map')");return ymaps.load(["package.map"],this._initMapObject,this)}if(this.options.traffic)if(ymaps.control===undefined||ymaps.control.TrafficControl===undefined){console.debug("L.Yandex: loading traffic and controls");return ymaps.load(["package.traffic","package.controls"],this._initMapObject,this)}var e=new ymaps.Map(this._container,{center:[0,0],zoom:0,behaviors:[]});if(this.options.traffic)e.controls.add(new ymaps.control.TrafficControl({shown:true}));if(this._type=="yandex#null"){this._type=new ymaps.MapType("null",[]);e.container.getElement().style.background="transparent"}e.setType(this._type);this._yandex=e;this._update(true)},_resetCallback:function(e){this._reset(e.hard)},_reset:function(e){this._initContainer()},_update:function(e){if(!this._yandex)return;this._resize(e);var t=this._map.getCenter();var n=[t.lat,t.lng];var r=this._map.getZoom();if(e||this._yandex.getZoom()!=r)this._yandex.setZoom(r);this._yandex.panTo(n,{duration:0,delay:0})},_resize:function(e){var t=this._map.getSize(),n=this._container.style;if(n.width==t.x+"px"&&n.height==t.y+"px")if(e!=true)return;this.setElementSize(this._container,t);var r=this._map.getBounds(),i=r.getSouthWest(),s=r.getNorthEast();this._yandex.container.fitToViewport()}});L.GeoManager=L.Class.extend({options:{tag:"geomanager0",selectors:['[data-geomanager-interactivelayers="{tag}"]','[data-geomanager-overlays="{tag}"]','[data-geomanager-baselayers="{tag}"]']},apikeys:[],providers:[],initialize:function(e){var t=this,n=L.extend({},e);t.setOptions(n)},registerAPIKeys:function(e){for(var t=0;t<e.length;t++){var n=e[t];L.GeoManager.prototype.apikeys[n.name]=n}},onAdd:function(e){var t=this;t._map=e;e.on("popupclose",this._popupClose,this);t._layers=new L.LayerGroup;t._layers.addTo(t._map);t.setOptions(t.options);t._bindActions(L.GeoManager.prototype.providers)},_popupClose:function(){var e=this;if(e._geocodelayer){e._map.removeLayer(e._geocodelayer);console.log("remove geocode layer")}},onRemove:function(e){e.off("popupclose",this._popupClose,this)},addTo:function(e){e.addLayer(this);return this},_getFunctionByName:function(e){var t=window,n=e.split("."),r=n.pop();for(var i=0;i<n.length;i++){t=t[n[i]]}return t[r]},makeFun:function(e,t){var n=this,r=n._getFunctionByName(e.providername);e.map=n.map;var i=r(e);$.when(i).done(function(e){if(t=="remove"){n._layers.removeLayer(n._layers.getLayerId(e))}else{n._layers.addLayer(e,true)}})},_renderLayer:function(e){var t=this,n=e.attr("data-geomanager-type"),r=e.attr("data-geomanager-options"),i=r?JSON.parse(r):{},s=t._getFunctionByName(i.providername);i.map=t._map;layerPromise=s(i);$.when(layerPromise).done(function(n){n.geomanager.provider=s;var r=t.layerTemplate(n);r.data("geomanager",n);r.find("i.icon-remove-sign-right").on("click",function(e){e.stopPropagation();r.remove();t.refreshLeafletLayers()});e.replaceWith(r);if(t._timer){window.clearTimeout(t._timer)}t._timer=window.setTimeout(function(){t.refreshLeafletLayers()},500)})},_addLayer:function(e){var t=this;console.log(t);t._layers.addLayer(e,true)},refreshLeafletLayers:function(){var e=this,t,n,r,i=[],s=e.options.tag,o=e._selectors;for(t=0;t<o.length;t++){var u=o[t];$(u+" [data-geomanager-layer]").each(function(e,t){var n=$(t).data("geomanager");i.push(n)})}e._layers.clearLayers();n=i;for(t=0;t<n.length;t++){e._layers.addLayer(n[t],true);if(n[t].bringToBack){n[t].bringToBack()}}},_bindActions:function(e){return false;var t=this,n=t.options.tag,r=t._selectors,i,s;for(i=0;i<r.length;i++){var o=$(r[i]);o.children("[data-geomanager-type]").each(function(e,n){var r=$(n);t._renderLayer(r)});o.sortable({}).on("sortupdate",function(e,n){$node=n.item;if($node.attr("data-geomanager-type")){t._renderLayer($node)}else{t.refreshLeafletLayers()}})}$('[data-geomanager-sourcelayers="'+n+'"] [data-geomanager-type]').each(function(e,n){var r=$(n),i=r.attr("data-geomanager-type");r.draggable({connectToSortable:"[data-geomanager-"+i+'="'+t.options.tag+'"]',helper:"clone",revert:"invalid",appendTo:"#"+t.options.tag+"drag"})})},_updateSelectors:function(){var e=this,t=e.options.selectors,n=[];for(i=0;i<t.length;i++){n.push(L.Util.template(t[i],{tag:e.options.tag}))}e._selectors=n},setOptions:function(e){var t=this,n=L.extend({},e);if(n&&n.tag){t.options.tag=n.tag;t._updateSelectors()}if(n&&n.apikeys){t.options.apikeys=L.extend(t.options.apikeys,n.apikeys)}return this},layerTemplate:function(e){var t="",n="geomanager"+Math.floor(Math.random()*1e5),r=e.geomanager.renderOptionsForm,i=e.geomanager.provider,s=e.geomanager.options.providername.toLowerCase().replace(/\./g,"-");t=t+"<li data-geomanager-layer>"+'  <div class="round clearfix">'+'     <i class="icon-remove icon-remove-sign-right"></i>'+(r?'     <i class="icon-edit icon-edit-sign-right" data-toggle="collapse" data-target="div[data-geomanager-optionsform=\''+n+"']\"></i>":"")+'     <span style="float:left;margin:4px;">'+e.geomanager.options.title+"</span>"+'     <div class="clearfix"></div>'+'     <div data-geomanager-optionsform="'+n+'" class="collapse" style="margin-top:10px;">'+"     </div>"+"  </div>"+"</li>";var o=$(t);if(r){o.find("[data-geomanager-optionsform]").append(r())}return o},geocode:function(e){var t=this,n=t._getFunctionByName(e.providername);$.when(n({query:e.query})).done(function(e){if(e.layer){t._map.closePopup();t._geocodelayer=e.layer;t._map.addLayer(t._geocodelayer)}if(e.bounds){t._map.fitBounds(e.bounds)}(new L.Popup).setLatLng(e.latlng).setContent(e.content).openOn(t._map)})}});if(L.version=="0.5.1"){L.Util.template=function(e,t){return e.replace(/\{ *([\w_]+) *\}/g,function(e,n){var r=t[n];if(!t.hasOwnProperty(n)){throw new Error("No value provided for variable "+e)}else if(typeof r==="function"){r=r(t)}return r})}}L.GeoManager.APILoaders={loadGoogleApi:function(){var e=new jQuery.Deferred;if(typeof google==="undefined"||typeof google.maps==="undefined"){$.getScript("https://www.google.com/jsapi",function(){google.load("maps","3",{other_params:"libraries=places&key=AIzaSyAGo33r6UECbDAJV63G20ULh6RtyzKBkXc",callback:function(){setTimeout(function(){e.resolve()},1e3)}})})}else e.resolve();return e.promise()},loadYandexApi:function(){var e=new jQuery.Deferred;if(typeof ymaps==="undefined"){$.getScript("http://api-maps.yandex.ru/2.0/?load=package.map&lang="+(window.navigator.userLanguage||window.navigator.language),function(){e.resolve()})}else e.resolve();return e.promise()}};L.GeoManager.OptionsFormsFactory={tileLayer:function(e){var t=""+'<span>Opacity: <input name="opacity" type="text" value="1.0"></span>';$node=$(t);$node.find('input[name="opacity"]').on("change",function(t){e.setOpacity($(t.target).val())});return $node},wms:function(e,t){var n="";if(t){n=n+"<ul>";for(var r=0;r<t.length;r++){var i=t[r];n=n+'<li><span><input name="sublayers.list[]" type="checkbox" value="'+i.id+'">'+i.name+"</span></li>"}n=n+"</ul>"}$node=$(n);$node.find("input").on("click",function(){var t=[];$node.find("input:checked").each(function(e,n){t.push($(n).val())});e.setOptions({layers:t.join(",")})});return $node}};L.GeoManager.ProvidersFactory={createSimpleTileLayerProvider:function(e){return function(t){var n=new jQuery.Deferred,r=new L.TileLayer(e.url,e);r.geomanager={options:t,renderOptionsForm:function(){return L.GeoManager.OptionsFormsFactory.tileLayer(r)}};n.resolve(r);return n.promise()}},createSimpleWMSTileLayerProvider:function(e){return function(t){var n=new jQuery.Deferred,r=e.url,i=e;delete i["url"];var s=new L.TileLayer.WMS(r,i);s.geomanager={options:t,renderOptionsForm:function(){return L.GeoManager.OptionsFormsFactory.tileLayer(s)}};n.resolve(s);return n.promise()}},createGoogleLayerProvider:function(e){return function(t){var n=new jQuery.Deferred;$.when(L.GeoManager.APILoaders.loadGoogleApi()).done(function(){var r=new L.Google(e.googlelayer);r.geomanager={options:t,renderOptionsForm:function(){return L.GeoManager.OptionsFormsFactory.tileLayer(r)}};n.resolve(r)});return n.promise()}},createBingLayerProvider:function(e){return function(t){var n=new jQuery.Deferred,r=new L.BingLayer(t.key,e.binglayer);r.geomanager={options:t,renderOptionsForm:function(){return L.GeoManager.OptionsFormsFactory.tileLayer(r)}};n.resolve(r);return n.promise()}},createYandexLayerProvider:function(e){return function(t){var n=new jQuery.Deferred;$.when(L.GeoManager.APILoaders.loadYandexApi()).done(function(){var r=new L.Yandex(e.yandexlayer);r.geomanager={options:t,renderOptionsForm:function(){return L.GeoManager.OptionsFormsFactory.tileLayer(r)}};n.resolve(r)});return n.promise()}},createArcGIS_EPSG900913_LayerProvider:function(e){return function(e){var t=this;var n=new jQuery.Deferred;ajaxopt={url:e.url,dataType:"jsonp",data:{f:"json"}};$.ajax(ajaxopt).done(function(t){var r=new L.ArcGIS_EPSG900913;var i={sublayers:t.layers,options:e,renderOptionsForm:function(){return L.GeoManager.OptionsFormsFactory.wms(r,i.sublayers)}};r.geomanager=i;n.resolve(r)});return n.promise()}}};L.GeoManager.LayersFactory={createSimpleIndentifyLayer:function(e){return L.Class.extend({initialize:function(){},onAdd:function(e){this._map=e;e.on("click",this._click,this);e.on("popupclose",this._popupClose,this)},onRemove:function(e){e.off("click",this._click,this);e.off("popupclose",this._popupClose,this)},_popupClose:function(e){var t=this;if(t._layer){t._map.removeLayer(t._layer)}},_click:function(t){var n=this;var r=t.originalEvent.target;if(r.getAttribute("data-dblclick")==null){r.setAttribute("data-dblclick",1);setTimeout(function(){if(r.getAttribute("data-dblclick")==1){$.when(e(t.latlng)).done(function(e){if(e.layer){n._layer=e.layer;n._map.addLayer(n._layer)}(new L.Popup).setLatLng(e.latlng).setContent(e.content).openOn(n._map)})}r.removeAttribute("data-dblclick")},300)}else{r.removeAttribute("data-dblclick")}}})}};L.GeoManager.White=L.GeoManager.ProvidersFactory.createSimpleTileLayerProvider({name:"white",type:"baselayers",url:"img/1x1white.gif"});L.GeoManager.Black=L.GeoManager.ProvidersFactory.createSimpleTileLayerProvider({name:"black",type:"baselayers",url:"img/1x1black.gif"});L.GeoManager.OSM=L.GeoManager.ProvidersFactory.createSimpleTileLayerProvider({name:"osm",type:"baselayers",url:"http://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png",attribution:'Map data &copy; <a href="http://openstreetmap.org">OpenStreetMap</a> contributors, <a href="http://creativecommons.org/licenses/by-sa/2.0/">CC-BY-SA</a>'});L.GeoManager.OSMBW=L.GeoManager.ProvidersFactory.createSimpleTileLayerProvider({name:"osmbw",type:"baselayers",url:"http://{s}.www.toolserver.org/tiles/bw-mapnik/{z}/{x}/{y}.png",attribution:'Map data &copy; <a href="http://openstreetmap.org">OpenStreetMap</a> contributors, <a href="http://creativecommons.org/licenses/by-sa/2.0/">CC-BY-SA</a>'});L.GeoManager.OSMCloudMade=L.GeoManager.ProvidersFactory.createSimpleTileLayerProvider({name:"osmcloudmade",type:"baselayers",key:function(){return L.GeoManager.prototype.apikeys["cloudmade"].value},url:"http://{s}.tile.cloudmade.com/{key}/997/256/{z}/{x}/{y}.png",attribution:'Map data &copy; <a href="http://openstreetmap.org">OpenStreetMap</a> contributors, <a href="http://creativecommons.org/licenses/by-sa/2.0/">CC-BY-SA</a>'});L.GeoManager.OpenCycleMap=L.GeoManager.ProvidersFactory.createSimpleTileLayerProvider({name:"opencyclemap",type:"baselayers",url:"http://{s}.tile.opencyclemap.org/cycle/{z}/{x}/{y}.png",attribution:'Map data &copy; <a href="http://openstreetmap.org">OpenStreetMap</a> contributors, <a href="http://creativecommons.org/licenses/by-sa/2.0/">CC-BY-SA</a>, <a href="http://www.opencyclemap.org">OpenCycleMap</a>'});L.GeoManager.OpenCycleMapTransport=L.GeoManager.ProvidersFactory.createSimpleTileLayerProvider({name:"opencyclemaptransport",type:"baselayers",url:"http://{s}.tile2.opencyclemap.org/transport/{z}/{x}/{y}.png",attribution:'Map data &copy; <a href="http://openstreetmap.org">OpenStreetMap</a> contributors, <a href="http://creativecommons.org/licenses/by-sa/2.0/">CC-BY-SA</a>, <a href="http://www.opencyclemap.org">OpenCycleMap</a>'});L.GeoManager.OpenCycleMapLandscape=L.GeoManager.ProvidersFactory.createSimpleTileLayerProvider({name:"opencyclemaplandscape",type:"baselayers",url:"http://{s}.tile3.opencyclemap.org/landscape/{z}/{x}/{y}.png",attribution:'Map data &copy; <a href="http://openstreetmap.org">OpenStreetMap</a> contributors, <a href="http://creativecommons.org/licenses/by-sa/2.0/">CC-BY-SA</a>, <a href="http://www.opencyclemap.org">OpenCycleMap</a>'});L.GeoManager.MapQuest=L.GeoManager.ProvidersFactory.createSimpleTileLayerProvider({name:"mapquest",type:"baselayers",url:"http://otile{s}.mqcdn.com/tiles/1.0.0/map/{z}/{x}/{y}.jpeg",subdomains:"1234",attribution:'Map data &copy; <a href="http://openstreetmap.org">OpenStreetMap</a> contributors, <a href="http://creativecommons.org/licenses/by-sa/2.0/">CC-BY-SA</a>, Tiles Courtesy of <a href="http://www.mapquest.com/">MapQuest</a>'});L.GeoManager.MapQuestAerial=L.GeoManager.ProvidersFactory.createSimpleTileLayerProvider({name:"mapquestaerial",type:"baselayers",url:"http://oatile{s}.mqcdn.com/tiles/1.0.0/sat/{z}/{x}/{y}.jpg",subdomains:"1234",attribution:'Tiles Courtesy of <a href="http://www.mapquest.com/">MapQuest</a>, Portions Courtesy NASA/JPL-Caltech and U.S. Depart. of Agriculture, Farm Service Agency'});L.GeoManager.StamenToner=L.GeoManager.ProvidersFactory.createSimpleTileLayerProvider({name:"samentoner",type:"baselayers",url:"http://{s}.tile.stamen.com/toner/{z}/{x}/{y}.png",attribution:'Map tiles by <a href="http://stamen.com">Stamen Design</a>',maxZoom:20});L.GeoManager.StamenTerrain=L.GeoManager.ProvidersFactory.createSimpleTileLayerProvider({name:"samenterrain",type:"baselayers",url:"http://{s}.tile.stamen.com/terrain/{z}/{x}/{y}.jpg",attribution:'Map tiles by <a href="http://stamen.com">Stamen Design</a>',minZoom:4,maxZoom:18});L.GeoManager.StamenWatercolor=L.GeoManager.ProvidersFactory.createSimpleTileLayerProvider({name:"samenwatercolor",type:"baselayers",url:"http://{s}.tile.stamen.com/watercolor/{z}/{x}/{y}.jpg",attribution:'Map tiles by <a href="http://stamen.com">Stamen Design</a>',minZoom:3,maxZoom:16});L.GeoManager.ESRIStreetMap=L.GeoManager.ProvidersFactory.createSimpleTileLayerProvider({name:"esristreetmap",type:"baselayers",url:"http://server.arcgisonline.com/ArcGIS/rest/services/World_Street_Map/MapServer/tile/{z}/{y}/{x}",attribution:"Tiles &copy; Esri &mdash; Source: Esri, DeLorme, NAVTEQ, USGS, Intermap, iPC, NRCAN, Esri Japan, METI, Esri China (Hong Kong), Esri (Thailand), TomTom, 2012"});L.GeoManager.ESRITopoMap=L.GeoManager.ProvidersFactory.createSimpleTileLayerProvider({name:"esritopomap",type:"baselayers",url:"http://server.arcgisonline.com/ArcGIS/rest/services/World_Topo_Map/MapServer/tile/{z}/{y}/{x}",attribution:"Tiles &copy; Esri &mdash; Esri, DeLorme, NAVTEQ, TomTom, Intermap, iPC, USGS, FAO, NPS, NRCAN, GeoBase, Kadaster NL, Ordnance Survey, Esri Japan, METI, Esri China (Hong Kong), and the GIS User Community"});L.GeoManager.ESRIImagery=L.GeoManager.ProvidersFactory.createSimpleTileLayerProvider({name:"esriimagery",type:"baselayers",url:"http://server.arcgisonline.com/ArcGIS/rest/services/World_Imagery/MapServer/tile/{z}/{y}/{x}",attribution:"Tiles &copy; Esri &mdash; Source: Esri, i-cubed, USDA, USGS, AEX, GeoEye, Getmapping, Aerogrid, IGN, IGP, UPR-EGP, and the GIS User Community"});L.GeoManager.GoogleRoadmap=L.GeoManager.ProvidersFactory.createGoogleLayerProvider({name:"googleroadmap",type:"baselayers",googlelayer:"ROADMAP"});L.GeoManager.GoogleSatellite=L.GeoManager.ProvidersFactory.createGoogleLayerProvider({name:"googlesatellite",type:"baselayers",googlelayer:"SATELLITE"});L.GeoManager.GoogleHybrid=L.GeoManager.ProvidersFactory.createGoogleLayerProvider({name:"googlehybrid",type:"baselayers",googlelayer:"HYBRID"});L.GeoManager.GoogleTerrain=L.GeoManager.ProvidersFactory.createGoogleLayerProvider({name:"googleterrain",type:"baselayers",googlelayer:"TERRAIN"});L.GeoManager.BingRoad=L.GeoManager.ProvidersFactory.createBingLayerProvider({name:"bingroad",type:"baselayers",binglayer:{type:"Road"}});L.GeoManager.BingAerial=L.GeoManager.ProvidersFactory.createBingLayerProvider({name:"bingaerial",type:"baselayers",binglayer:{type:"Aerial"}});L.GeoManager.BingAerialWithLabels=L.GeoManager.ProvidersFactory.createBingLayerProvider({name:"bingaerialwithlabels",type:"baselayers",binglayer:{type:"AerialWithLabels"}});L.GeoManager.YandexMap=L.GeoManager.ProvidersFactory.createYandexLayerProvider({name:"yandexmap",type:"baselayers",yandexlayer:"map"});L.GeoManager.YandexSatellite=L.GeoManager.ProvidersFactory.createYandexLayerProvider({name:"yandexsatellite",type:"baselayers",yandexlayer:"satellite"});L.GeoManager.YandexHybrid=L.GeoManager.ProvidersFactory.createYandexLayerProvider({name:"yandexhybrid",type:"baselayers",yandexlayer:"hybrid"});L.GeoManager.YandexPublicMap=L.GeoManager.ProvidersFactory.createYandexLayerProvider({name:"yandexpublicmap",type:"baselayers",yandexlayer:"publicMap"});L.GeoManager.YandexPublicMapHybrid=L.GeoManager.ProvidersFactory.createYandexLayerProvider({name:"yandexpublicmaphybrid",type:"baselayers",yandexlayer:"publicMapHybrid"});L.GeoManager.Wikimapia=L.GeoManager.ProvidersFactory.createSimpleTileLayerProvider({name:"wikimapia",type:"baselayers",url:"http://{s}{hash}.wikimapia.org/?x={x}&y={y}&zoom={z}&r=7071412&type=&lng=1",subdomains:"i",hash:function(e){return e.x%4+e.y%4*4},maxZoom:18,attribution:'<a href="http://wikimapia.org" target="_blank">Wikimapia.org</a>'});L.GeoManager.ArcGIS_EPSG900913_Overlay=L.GeoManager.ProvidersFactory.createArcGIS_EPSG900913_LayerProvider({name:"arcgis_epsg900913",type:"overlays"});L.GeoManager.WikimapiaOverlay=L.GeoManager.ProvidersFactory.createSimpleTileLayerProvider({name:"wikimapiaoverlay",type:"overlays",url:"http://{s}{hash}.wikimapia.org/?x={x}&y={y}&zoom={z}&r=6481976&type=hybrid&lng=1",subdomains:"i",hash:function(e){return e.x%4+e.y%4*4},maxZoom:18,attribution:'<a href="http://wikimapia.org" target="_blank">Wikimapia.org</a>'});L.GeoManager.UACadastre=L.GeoManager.ProvidersFactory.createSimpleWMSTileLayerProvider({name:"uacadastre",type:"overlays",url:"http://212.26.144.110/geowebcache/service/wms",layers:"kadastr",format:"image/png",transparent:true,crs:L.CRS.EPSG900913,maxZoom:18,attribution:'<a href="http://dzk.gov.ua" target="_blank">ЦДЗК</a>'});L.GeoManager.ArgGIS=function(e){var t=this;var n=new jQuery.Deferred;ajaxopt={url:"http://maps.rosreestr.ru/arcgis/rest/services/Cadastre/Cadastre/MapServer",dataType:"jsonp",data:{f:"json"}};$.ajax(ajaxopt).done(function(t){var r=new L.RUCadastre;var i={sublayers:t.layers,options:e,renderOptionsForm:function(){return L.GeoManager.OptionsFormsFactory.wms(r,this.sublayers)}};r.geomanager=i;n.resolve(r)});return n.promise()};L.GeoManager.OSMIdentify=function(e){var t=this;var n=new jQuery.Deferred;var r=function(e){var t=new jQuery.Deferred;$.ajax({url:"http://nominatim.openstreetmap.org/reverse",dataType:"jsonp",jsonp:"json_callback",data:{lat:e.lat,lon:e.lng,format:"json"}}).done(function(e){if(e){var n=e;t.resolve({content:n.display_name,latlng:new L.LatLng(n.lat,n.lon)})}});return t.promise()};var i=new(L.GeoManager.LayersFactory.createSimpleIndentifyLayer(r));var s={options:e};i.geomanager=s;n.resolve(i);return n.promise()};L.GeoManager.GoogleIdentify=function(e){var t=this;var n=new jQuery.Deferred;$.when(L.GeoManager.APILoaders.loadGoogleApi()).done(function(){var r=function(n){var r=new jQuery.Deferred;console.log(e,t);var i=new google.maps.places.PlacesService($("#gmap")[0]);i.nearbySearch({location:new google.maps.LatLng(n.lat,n.lng),radius:1},function(e,t){if(t==google.maps.places.PlacesServiceStatus.OK){dump=e;var n=e[0];r.resolve({content:n.name,latlng:new L.LatLng(n.geometry.location.lat(),n.geometry.location.lng()),layer:new L.Circle(new L.LatLng(n.geometry.location.lat(),n.geometry.location.lng()),5)})}});return r.promise()};var i=new(L.GeoManager.LayersFactory.createSimpleIndentifyLayer(r));var s={options:e};i.geomanager=s;n.resolve(i)});return n.promise()};L.GeoManager.BingIdentify=function(e){var t=this;var n=new jQuery.Deferred;var r=function(t){var n=new jQuery.Deferred;$.ajax({url:"http://dev.virtualearth.net/REST/v1/Locations/"+t.lat+","+t.lng,dataType:"jsonp",jsonp:"jsonp",data:{key:e.key}}).done(function(e){if(e.resourceSets.length>0&&e.resourceSets[0].resources.length>0){var t=e.resourceSets[0].resources[0],r=new L.LatLngBounds([t.bbox[0],t.bbox[1]],[t.bbox[2],t.bbox[3]]);n.resolve({content:t.name,latlng:new L.LatLng(t.point.coordinates[0],t.point.coordinates[1]),bounds:r,layer:new L.Rectangle(r)})}});return n.promise()};var i=new(L.GeoManager.LayersFactory.createSimpleIndentifyLayer(r));var s={options:e};i.geomanager=s;n.resolve(i);return n.promise()};L.GeoManager.YandexIdentify=function(e){var t=this;var n=new jQuery.Deferred;var r=function(e){var t=new jQuery.Deferred;$.ajax({url:"http://geocode-maps.yandex.ru/1.x/",dataType:"jsonp",data:{geocode:e.lng+","+e.lat,format:"json"}}).done(function(e){if(e.response.GeoObjectCollection.featureMember.length>0){var n=e.response.GeoObjectCollection.featureMember[0].GeoObject,r=n.Point.pos.split(" "),i=n.boundedBy.Envelope.lowerCorner.split(" "),s=n.boundedBy.Envelope.upperCorner.split(" "),o=n.metaDataProperty.GeocoderMetaData.text,u=new L.LatLngBounds([i[1],i[0]],[s[1],s[0]]);t.resolve({content:o,latlng:new L.LatLng(r[1],r[0]),bounds:u,layer:new L.Rectangle(u)})}});return t.promise()};var i=new(L.GeoManager.LayersFactory.createSimpleIndentifyLayer(r));var s={options:e};i.geomanager=s;n.resolve(i);return n.promise()};L.GeoManager.WikimapiaInteractive=function(e){var t=this;var n=new jQuery.Deferred;var r=new L.WikimapiaInteractive({key:L.GeoManager.prototype.apikeys["wikimapia"].value,onActiveFeature:function(e,t){if(e.name&&e.url){t.bindLabel(e.name).bindPopup('<a target="_blank" href="'+e.url+'">'+e.name+"</a>")}},onActiveFeatureStyle:function(e){return{color:"#ffcc00",weight:"1",fillOpacity:"0.4",opacity:"1"}},style:function(e){return{color:"#0000FF",opacity:"1",weight:"1",fillOpacity:"0"}}});var i={options:e};r.geomanager=i;n.resolve(r);return n.promise()};L.GeoManager.OSMGeocode=function(e){var t=this;var n=new jQuery.Deferred;$.ajax({url:"http://nominatim.openstreetmap.org/search",dataType:"jsonp",jsonp:"json_callback",data:{q:e.query,format:"json"}}).done(function(e){if(e.length>0){var t=e[0],r=new L.LatLngBounds([t.boundingbox[0],t.boundingbox[2]],[t.boundingbox[1],t.boundingbox[3]]);n.resolve({content:t.display_name,latlng:new L.LatLng(t.lat,t.lon),bounds:r,layer:new L.Rectangle(r)})}});return n.promise()};L.GeoManager.GoogleGeocode=function(e){var t=this;var n=new jQuery.Deferred;$.when(L.GeoManager.APILoaders.loadGoogleApi()).done(function(){var t=new google.maps.Geocoder;t.geocode({address:e.query},function(e,t){if(t==google.maps.GeocoderStatus.OK){var r=e[0],i=r.geometry.bounds?r.geometry.bounds:r.geometry.viewport,s=new L.LatLngBounds([i.getSouthWest().lat(),i.getSouthWest().lng()],[i.getNorthEast().lat(),i.getNorthEast().lng()]);n.resolve({content:r.formatted_address,latlng:new L.LatLng(r.geometry.location.lat(),r.geometry.location.lng()),bounds:s,layer:new L.Rectangle(s)})}})});return n.promise()};L.GeoManager.BingGeocode=function(e){var t=this;var n=new jQuery.Deferred;$.ajax({url:"http://dev.virtualearth.net/REST/v1/Locations",dataType:"jsonp",jsonp:"jsonp",data:{q:e.query,key:L.GeoManager.prototype.apikeys["bing"].value}}).done(function(e){if(e.resourceSets.length>0&&e.resourceSets[0].resources.length>0){var t=e.resourceSets[0].resources[0],r=new L.LatLngBounds([t.bbox[0],t.bbox[1]],[t.bbox[2],t.bbox[3]]);n.resolve({content:t.name,latlng:new L.LatLng(t.point.coordinates[0],t.point.coordinates[1]),bounds:r,layer:new L.Rectangle(r)})}});return n.promise()};L.GeoManager.ESRIGeocode=function(e){var t=this;var n=new jQuery.Deferred;$.ajax({url:"http://geocode.arcgis.com/arcgis/rest/services/World/GeocodeServer/find",dataType:"jsonp",data:{text:e.query,f:"pjson"}}).done(function(e){if(e.locations.length>0){var t=e.locations[0],r=new L.LatLngBounds([t.extent.ymin,t.extent.xmin],[t.extent.ymax,t.extent.xmax]);n.resolve({content:t.name,latlng:new L.LatLng(t.feature.geometry.y,t.feature.geometry.x),bounds:r,layer:new L.Rectangle(r)})}});return n.promise()};L.GeoManager.YandexGeocode=function(e){var t=this;var n=new jQuery.Deferred;$.ajax({url:"http://geocode-maps.yandex.ru/1.x/",dataType:"jsonp",data:{geocode:e.query,format:"json"}}).done(function(e){if(e.response.GeoObjectCollection.featureMember.length>0){var t=e.response.GeoObjectCollection.featureMember[0].GeoObject,r=t.Point.pos.split(" "),i=t.boundedBy.Envelope.lowerCorner.split(" "),s=t.boundedBy.Envelope.upperCorner.split(" "),o=t.metaDataProperty.GeocoderMetaData.text,u=new L.LatLngBounds([i[1],i[0]],[s[1],s[0]]);n.resolve({content:o,latlng:new L.LatLng(r[1],r[0]),bounds:u,layer:new L.Rectangle(u)})}});return n.promise()};L.GeoManager.GeonamesGeocode=function(e){var t=this;var n=new jQuery.Deferred;$.ajax({url:"http://ws.geonames.org/searchJSON",dataType:"jsonp",data:{q:e.query,style:"full",maxRows:"1"}}).done(function(e){if(e.geonames.length>0){var t=e.geonames[0],r=new L.LatLngBounds([t.bbox.south,t.bbox.west],[t.bbox.north,t.bbox.east]);n.resolve({content:t.name,latlng:new L.LatLng(t.lat,t.lng),bounds:r,layer:new L.Rectangle(r)})}});return n.promise()};L.GeoManager.MapQuestGeocode=function(e){var t=this;var n=new jQuery.Deferred;$.ajax({url:"http://www.mapquestapi.com/geocoding/v1/address",dataType:"jsonp",data:{location:e.query,key:L.GeoManager.prototype.apikeys["mapquest"].value,outFormat:"json",maxResults:"1"}}).done(function(e){if(e.results.length>0&&e.results[0].locations.length>0){var t=e.results[0],r=t.locations[0].latLng,i=new L.LatLngBounds([r.lat-1,r.lng-1],[r.lat+1,r.lng+1]);n.resolve({content:t.providedLocation.location,latlng:new L.LatLng(r.lat,r.lng),bounds:i,layer:new L.Rectangle(i)})}});return n.promise()};L.GeoManager.NokiaGeocode=function(e){var t=this;var n=new jQuery.Deferred;$.ajax({url:"http://geo.nlp.nokia.com/search/6.2/geocode.json",dataType:"jsonp",jsonp:"jsoncallback",data:{searchtext:e.query,app_id:L.GeoManager.prototype.apikeys["nokia"].value}}).done(function(e){if(e.Response.View.length>0&&e.Response.View[0].Result.length>0){var t=e.Response.View[0].Result[0],r=new L.LatLngBounds([t.extent.ymin,t.extent.xmin],[t.extent.ymax,t.extent.xmax]);n.resolve({content:t.name,latlng:new L.LatLng(t.Location.DisplayPosition.Latitude,t.Location.DisplayPosition.Longitude),bounds:r,layer:new L.Rectangle(r)})}});return n.promise()}
